(function(){"use strict";let n;const i=["chrome://","chrome-extension://","chrome.google.com","chromewebstore.google.com"];chrome.runtime.onInstalled.addListener(()=>{console.log("Spacecow Extension initialised"),u(),c()});function u(){chrome.contextMenus.create({id:"spacecowMenu",title:"Spacecow Pet",contexts:["all"]}),chrome.contextMenus.create({id:"generatePassword",parentId:"spacecowMenu",title:"Generate Password",contexts:["all"]}),chrome.contextMenus.create({id:"checkWriting",parentId:"spacecowMenu",title:"Show Writing Stats",contexts:["all"]}),chrome.contextMenus.create({id:"takeBreak",parentId:"spacecowMenu",title:"Take a Break",contexts:["all"]})}chrome.contextMenus.onClicked.addListener((e,t)=>{if(t)switch(e.menuItemId){case"generatePassword":o(t.id,{action:"generatePassword"});break;case"checkWriting":o(t.id,{action:"showWritingStats"});break;case"takeBreak":s(t.id);break}});function c(){n&&clearInterval(n),n=setInterval(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&s(e[0].id)})},18e5)}function s(e){o(e,{action:"takeBreak",message:"Time for a break! Let's stretch and rest our eyes for a moment. ðŸŒŸ"})}chrome.tabs.onCreated.addListener(e=>{!e.url||a(e.url)||setTimeout(()=>{o(e.id,{action:"makeSpacecowCurious",url:e.url})},1e3)}),chrome.tabs.onUpdated.addListener((e,t,r)=>{t.status==="complete"&&r.url&&!a(r.url)&&o(e,{action:"checkInitialization",url:r.url})}),chrome.runtime.onMessage.addListener((e,t,r)=>{switch(e.action){case"resetBreakTimer":c(),r({success:!0});break;case"getSettings":return chrome.storage.sync.get(null,d=>{r({success:!0,settings:d})}),!0;case"updateSettings":return chrome.storage.sync.set(e.settings,()=>{r({success:!0})}),!0;default:r({success:!1,error:"Unknown action"})}});function o(e,t){try{chrome.tabs.sendMessage(e,t,r=>{chrome.runtime.lastError&&(console.log(`Message failed: ${chrome.runtime.lastError.message}`),chrome.runtime.lastError.message.includes("receiving end does not exist")&&l(e))})}catch(r){console.error("Error sending message:",r)}}function l(e){chrome.scripting.executeScript({target:{tabId:e},files:["content/content.bundle.js"]}).catch(t=>{console.error("Failed to inject content script:",t)}),chrome.scripting.insertCSS({target:{tabId:e}}).catch(t=>{console.error("Failed to inject CSS:",t)})}function a(e){return i.some(t=>e.startsWith(t))}chrome.runtime.onUpdateAvailable.addListener(()=>{console.log("Update available. Reloading extension..."),chrome.runtime.reload()}),chrome.runtime.onSuspend.addListener(()=>{console.log("Extension being unloaded. Cleaning up..."),n&&clearInterval(n)})})();
